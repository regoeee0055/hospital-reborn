<!doctype html>
<html lang="th">
<head>
    <meta charset="utf-8">
    <title>‡∏Ñ‡∏¥‡∏ß‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</title>

    {% load static %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/queue.css' %}">
</head>
<body>

<!-- Top bar -->
<header class="topbar">
    <div class="logo">
    <a href="{% url 'queue_list' %}" class="home-link">
        üè• ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏ß‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•
    </a>
  </div>

    <div class="nav">
        <a href="/patients/register/">+ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</a>
        <a href="/accounts/dashboard/">Dashboard</a>
    </div>
</header>

<main class="container">

    <h2>‚è≥ ‡∏Ñ‡∏¥‡∏ß‡∏£‡∏≠ (Waiting Queue)</h2>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Visit</th>
                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</th>
                    <th>‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
                    <th>AI</th>
                    <th>‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</th>
                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>

            <tbody>
            {% for q in q_items %}
                <tr class="severity-{{ q.visit.final_severity|lower }}">
                    <td>#{{ q.visit.id }}</td>

                    <td>
                        {{ q.visit.patient.first_name }}
                        {{ q.visit.patient.last_name }}
                    </td>

                    <td>
                        <span class="badge {{ q.visit.final_severity|lower }}">
                            {{ q.visit.final_severity }}
                        </span>
                    </td>

                    <td>
                        {% if q.visit.triage_result %}
                            {{ q.visit.triage_result.ai_severity }}
                            {% if q.visit.triage_result.confidence %}
                                ({{ q.visit.triage_result.confidence }})
                            {% endif %}
                        {% else %}
                            -
                        {% endif %}
                    </td>

                    <td>
                        {{ q.visit.registered_at|date:"H:i" }}
                    </td>

                    <td class="actions">
                        <!-- ‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á -->
                        <form method="post" action="{% url 'triage_visit' q.visit.id %}">
                            {% csrf_token %}
                            <select name="severity">
                                <option value="GREEN"  {% if q.visit.final_severity == "GREEN" %}selected{% endif %}>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß</option>
                                <option value="YELLOW" {% if q.visit.final_severity == "YELLOW" %}selected{% endif %}>‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</option>
                                <option value="RED"    {% if q.visit.final_severity == "RED" %}selected{% endif %}>‡πÅ‡∏î‡∏á</option>
                            </select>
                            <button class="btn small">‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á</button>
                        </form>

                        <!-- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏¥‡∏ß -->
                        <form method="post" action="{% url 'call_visit' q.visit.id %}">
                            {% csrf_token %}
                            <button class="btn call">‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏¥‡∏ß</button>
                        </form>
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="6" class="empty">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡∏£‡∏≠</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

</main>

</body>
</html>
